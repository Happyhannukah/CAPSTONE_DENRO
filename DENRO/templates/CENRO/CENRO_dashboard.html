{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>CENRO Dashboard</title>
    <link rel="stylesheet" href="{% static 'styles/dashboard.css' %}" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="{% static 'styles/sidebar.css' %}" />
  </head>
  <body>
    <!-- Sidebar -->
    {% include 'includes/sidenav/sidenav_cenro.html' %}

    <!-- Main Content -->
    <div class="content">
      <!-- Top Bar -->
      <div class="top-bar">
        <h2>Welcome back, CENRO ðŸ‘‹</h2>
        <div class="notification">
          <button id="notifBtn" class="bell-btn">
            ðŸ”” {% if unread_count > 0 %}
            <span class="badge">{{ unread_count }}</span>
            {% endif %}
          </button>
          <div class="notif-dropdown" id="notifDropdown">
            <h4>Notifications</h4>
            <ul>
              {% for note in notifications %}
              <li>
                {{ note.message }} <br />
                <small>{{ note.created_at|date:"M d, Y H:i" }}</small>
                <form
                  method="post"
                  action="{% url 'mark_notification_read' note.id %}"
                >
                  {% csrf_token %}
                  <button type="submit" class="mark-btn">Mark as read</button>
                </form>
              </li>
              {% empty %}
              <li>No new notifications</li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>

      <!-- Cards -->
      <div class="cards">
        <div class="card">
          <h2>APPROVED</h2>
          <p>{{ stats.approved_users|default:0 }}</p>
        </div>
        <div class="card">
          <h2>REJECTED</h2>
          <p>{{ stats.rejected_users|default:0 }}</p>
        </div>
        <div class="card">
          <h2>PENDING</h2>
          <p>{{ stats.pending_users|default:0 }}</p>
        </div>
        <div class="card">
          <h2>EVALUATORS</h2>
          <p>{{ stats.evaluators|default:0 }}</p>
        </div>
      </div>

      <!-- Charts Row -->
      <div class="charts-row">
        <div class="chart-container">
          <h3>Report Status Overview</h3>
          <canvas id="reportStatusChart" data-pending="{{ stats.pending_reports|default:0 }}" data-accepted="{{ stats.accepted_reports|default:0 }}" data-declined="{{ stats.declined_reports|default:0 }}"></canvas>
        </div>
        <div class="chart-container">
          <h3>Account Status</h3>
          <canvas id="accountStatusChart" data-approved="{{ stats.approved_users|default:0 }}" data-pending="{{ stats.pending_users|default:0 }}" data-rejected="{{ stats.rejected_users|default:0 }}" data-deactivated="{{ stats.deactivated_users|default:0 }}"></canvas>
        </div>
      </div>

      <!-- Recent Users -->
      <div class="section-title">Recent Users</div>
      <div class="table-wrap">
        <table>
          <tr>
            <th>Username</th>
            <th>Email</th>
            <th>Role</th>
            <th>Last Login</th>
          </tr>
          {% for user in users %}
          <tr>
            <td>{{ user.username }}</td>
            <td>{{ user.email }}</td>
            <td>{{ user.role }}</td>
            <td>{{ user.last_login|default:"Never" }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="4">No users found</td>
          </tr>
          {% endfor %}
        </table>
      </div>

      <!-- Activity Logs Section -->
      <div class="section-title">Activity Logs</div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>User</th>
              <th>Action</th>
              <th>Details</th>
              <th>Timestamp</th>
            </tr>
          </thead>
          <tbody>
            {% for log in logs %}
            <tr>
              <td>{{ log.user.username }}</td>
              <td>{{ log.action }}</td>
              <td>{{ log.details }}</td>
              <td>{{ log.created_at|date:"M d, Y H:i" }}</td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="4">No logs found</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- JS -->
    <script src="{% static 'js/admin_dashboard.js' %}"></script>
  </body>
</html>
